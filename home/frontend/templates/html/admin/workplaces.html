{% extends "html/index.html" %}
{% load static %}

{% block main_content %}
<div class="row mt-2">
    <div class="col">
        <h2 class="text-primary">Workplaces</h2>
         <ul class="nav nav-tabs mt-4" id="employee-tabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="add-workplaces-tab" data-toggle="tab" href="#addWorkplace" role="tab">Add</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="show-workplaces-tab" data-toggle="tab" href="#showWorkplaces" role="tab">Workplaces</a>
            </li>
         </ul>
        <div class="tab-content m-2" id="myTabContent">
            <div class="tab-pane show active" id="addWorkplace" role="tabpanel">
                <form id="add-workplace-form" method="POST" action="{% url 'workplaceAdd' %}">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col col-xl-8">
                            <h4 class="text-primary">Add Workplace</h4>
                            <div class="form-group">
                                <label for="workplace_name">Name:</label>
                                <input type="text" class="form-control" name="workplace_name" id="workplace_name" required>
                            </div>
                            <div class="form-group">
                                <label for="workplace_desc">Description:</label>
                                <input type="text" class="form-control" name="workplace_desc" id="workplace_desc" required>
                            </div>
                            <div class="form-group row align-items-center">
                                <div class="col-6">
                                    <label for="workplace_desc">Add competencies and their relevance:</label>
                                </div>
                                <div class="col-6 text-right">
                                    <span id="addCompReleField" style="cursor:pointer;" class="text-primary"><i class="fas fa-plus"></i></span>
                                </div>
                            </div>
                            <div class="comprele">
                                <div class="form-group row align-items-center">
                                    <div class="col-6">
                                        <select class="form-control" name="competence0" id="competence0">
                                            {% for obj in competency %}
                                                <option>{{obj.slo_name}}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-3">
                                        <input type="text" class="form-control" name="minReq0" id="minReq0" placeholder="Minimum required score" required>
                                    </div>
                                    <div class="col-3">
                                        <input type="text" class="form-control" name="relevance0" id="relevance0" placeholder="Relevance" required>
                                    </div>
                                </div>
                            </div>
                            <div class="text-right">
                                <button type="submit" class="btn btn-primary">Add</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="tab-pane" id="showWorkplaces" role="tabpanel">
                <div class="row">
                    <!-- Table of Workplaces -->
                    <div class="col-xl-6">
                        <h4 class="text-primary">Workplaces</h4>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="bg-primary text-white" style="font-size: .65rem;">
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">NAME</th>
                                        <th scope="col">DESCRIPTION</th>
                                        <th scope="col" class="text-center">EDIT / DELETE</th>
                                    </tr>
                                </thead>
                                <tbody style="font-size: .875rem; color:#525f7f; word-break: break-all;">
                                    {% include 'html/admin/partial_table_workplaces.html' %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- Table of Competencies and their Relevance -->
                    <div class="col-xl-6" id="hiddenCompRel" hidden>
                        <h4 class="text-primary">Competencies and Relevance</h4>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="bg-primary text-white" style="font-size: .65rem;">
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">COMPETENCE</th>
                                        <th scope="col">RELEVANCE</th>
                                        <th scope="col" class="text-center">EDIT / DELETE</th>
                                    </tr>
                                </thead>
                                <tbody style="font-size: .875rem; color:#525f7f; word-break: break-all;">
                                    <tr>
                                        <th scope="row">1</th>
                                        <td>Some Competence</td>
                                        <td><strong>1</strong></td>
                                        <td class="text-center">
                                            <i class="far fa-edit text-success editIconModal" data-toggle="modal" data-target="#editModal"></i> / <i class="far fa-trash-alt text-danger deleteIconModal" data-toggle="modal" data-target="#deleteModal"></i>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock main_content %}

{% block scripts %}
<script>


var data = [];

$("#competence0 option").each(function(){
    data.push($(this).val());
});

$("#competence0").select2({data: data});

var idCounter = 1;

$("#addCompReleField").on("click", function(){
    inputFieldsHtml = '<div class="form-group row align-items-center" id="'+idCounter+'">'+
        '<div class="col-6">'+
            '<select class="form-control" name="competence'+idCounter+'" id="competence'+idCounter+'">{% for obj in competency %}<option>{{obj.slo_name}}</option>{% endfor %}</select>'+
        '</div>'+
        '<div class="col-3">'+
            '<input type="text" class="form-control" name="minReq'+idCounter+'" id="minReq'+idCounter+'" placeholder="Minimum required score" required>'+
        '</div>'+
        '<div class="col-2">'+
            '<input type="text" class="form-control" name="relevance'+idCounter+'" id="relevance'+idCounter+'" placeholder="Relevance" required>'+
        '</div>'+
        '<div class="col-1 text-right">'+
            '<span class="deleteCompReleField text-danger" data-id="'+idCounter+'" style="cursor:pointer;"><i class="fas fa-minus"></i></span>'+
        '</div>'+
    '</div>';

    $(".comprele").append(inputFieldsHtml);
    $("#competence"+idCounter).select2({data: data});
    idCounter++;
});

$(".comprele").on("click", ".deleteCompReleField", function(){
    $("#"+$(this).data("id")).remove();
});
</script>
{% endblock %}
